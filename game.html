<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ï–∂–µ–¥–Ω–µ–≤–∫–∞ ‚Äî –ò–≥—Ä–∞</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #88c0d0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.menu {
    text-align: center;
}

.menu h1 {
    font-size: 48px;
    color: #fff;
    margin-bottom: 20px;
}

.menu button {
    padding: 15px 30px;
    font-size: 20px;
    border-radius: 30px;
    border: none;
    cursor: pointer;
    background: white;
    margin-bottom: 20px;
}

.menu-links {
    display: flex;
    justify-content: center;
    gap: 15px;
}

.menu-links a {
    text-decoration: none;
    padding: 12px 22px;
    border-radius: 25px;
    background: rgba(255,255,255,0.85);
    color: #333;
    font-weight: bold;
}

.game {
    display: none;
    position: relative;
    width: 300px;
    height: 500px;
    background: linear-gradient(to bottom, #555, #333);
    overflow: hidden;
    border-radius: 10px;
}

.car {
    width: 60px;
    height: 100px;
    position: absolute;
    bottom: 20px;
    left: 120px;
    transition: left 0.2s;
}

.car img {
    width: 100%;
}

.obstacle, .coin {
    width: 60px;
    height: 60px;
    position: absolute;
    top: -60px;
}

.obstacle img, .coin img {
    width: 100%;
}

.score {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-weight: bold;
}
</style>
</head>

<body>

<div class="menu">
    <h1>–ï–∂–µ–¥–Ω–µ–≤–∫–∞</h1>
    <button onclick="startGame()">‚ñ∂ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

    <div class="menu-links">
        <a href="weather.html">üå§ –ü–æ–≥–æ–¥–∞</a>
        <a href="planner.html">üìí –ï–∂–µ–¥–Ω–µ–≤–Ω–∏–∫</a>
    </div>
</div>

<div class="game" id="game">
    <div class="score" id="score">–û—á–∫–∏: 0</div>
    <div class="car" id="car">
        <img src="blue-removebg-preview.png">
    </div>
</div>

<script>
const game = document.getElementById('game');
const car = document.getElementById('car');
const scoreEl = document.getElementById('score');

const lanes = [20, 120, 220];
let carLane = 1;

let obstacles = [];
let coins = [];
let score = 0;
let speed = 5;
let loop;

// –î–ª—è —Å–ø–∞–≤–Ω–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
let spawnCooldown = 0;

// –î–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
let nextSpeedIncrease = 5;

function startGame() {
    document.querySelector('.menu').style.display = 'none';
    game.style.display = 'block';

    obstacles.forEach(o => o.remove());
    coins.forEach(c => c.remove());
    obstacles = [];
    coins = [];

    score = 0;
    speed = 5;
    spawnCooldown = 0;
    nextSpeedIncrease = 5;
    scoreEl.textContent = '–û—á–∫–∏: 0';

    carLane = 1;
    car.style.left = lanes[carLane] + 'px';

    loop = setInterval(gameLoop, 50);
}

// –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ –æ—á–∫–∞–º (—Ç–æ–ª—å–∫–æ —Å–ø–∞–≤–Ω)
function difficulty() {
    if (score >= 30) return { chance: 0.095, gap: 70 };
    if (score >= 20) return { chance: 0.08, gap: 80 };
    if (score >= 10) return { chance: 0.065, gap: 90 };
    return { chance: 0.05, gap: 100 };
}

function gameLoop() {
    // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
    if (score >= nextSpeedIncrease) {
        speed += 1;
        nextSpeedIncrease += 5;
    }

    const d = difficulty();

    // –°–ø–∞–≤–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —Å —É—á–µ—Ç–æ–º cooldown
    spawnCooldown -= speed;
    if (spawnCooldown <= 0 && Math.random() < d.chance) {
        createObstacle();
        spawnCooldown = d.gap;
    }

    if (Math.random() < 0.015) createCoin();

    move(obstacles);
    move(coins);
    checkCollision();
}

function createObstacle() {
    const lane = Math.floor(Math.random() * 3);

    // –ù–µ –¥–∞–µ–º 3 –≤ —Ä—è–¥
    const sameLane = obstacles.filter(o =>
        parseInt(o.style.left) === lanes[lane] &&
        parseInt(o.style.top) < 120
    );

    if (sameLane.length >= 1) return;

    const o = document.createElement('div');
    o.className = 'obstacle';
    o.style.left = lanes[lane] + 'px';
    o.style.top = '-60px';
    o.innerHTML = '<img src="pngtree-tree-in-transparent-background-png-image_5717417-removebg-preview.png">';
    game.appendChild(o);
    obstacles.push(o);
}

function createCoin() {
    const lane = Math.floor(Math.random() * 3);
    const c = document.createElement('div');
    c.className = 'coin';
    c.style.left = lanes[lane] + 'px';
    c.style.top = '-60px';
    c.innerHTML = '<img src="monetka1-removebg-preview.png">';
    game.appendChild(c);
    coins.push(c);
}

function move(arr) {
    arr.forEach((obj, i) => {
        obj.style.top = (parseInt(obj.style.top) + speed) + 'px';

        if (parseInt(obj.style.top) > 500) {
            obj.remove();
            arr.splice(i, 1);
        }
    });
}

function checkCollision() {
    const carR = car.getBoundingClientRect();

    obstacles.forEach(o => {
        const r = o.getBoundingClientRect();
        if (
            carR.left + 10 < r.right - 10 &&
            carR.right - 10 > r.left + 10 &&
            carR.top + 20 < r.bottom - 20 &&
            carR.bottom - 10 > r.top + 10
        ) endGame();
    });

    coins.forEach((c, i) => {
        const r = c.getBoundingClientRect();
        if (
            carR.left + 15 < r.right - 15 &&
            carR.right - 15 > r.left + 15 &&
            carR.top + 25 < r.bottom - 25 &&
            carR.bottom - 15 > r.top + 15
        ) {
            score++;
            scoreEl.textContent = '–û—á–∫–∏: ' + score;
            c.remove();
            coins.splice(i, 1);
        }
    });
}

function endGame() {
    clearInterval(loop);
    alert('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –û—á–∫–∏: ' + score);
    game.style.display = 'none';
    document.querySelector('.menu').style.display = 'block';
}

document.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft' && carLane > 0) {
        carLane--;
        car.style.left = lanes[carLane] + 'px';
    }
    if (e.key === 'ArrowRight' && carLane < 2) {
        carLane++;
        car.style.left = lanes[carLane] + 'px';
    }
});
</script>

</body>
</html>
